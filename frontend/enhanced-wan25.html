<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAN-25 Preview - Advanced Image-to-Image</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; background: #0a0a0a; color: #e0e0e0; padding: 20px; }
        .container { max-width: 1600px; margin: 0 auto; }
        h1 { color: #ffffff; margin-bottom: 20px; font-size: 32px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        h2 { color: #ffffff; margin: 30px 0 20px 0; font-size: 24px; padding: 15px; background: linear-gradient(135deg, #1a1a2e, #16213e); border-left: 4px solid #667eea; border-radius: 4px; }
        .model-section { background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 25px; margin-bottom: 30px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
        .model-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #333; }
        .model-title { font-size: 20px; color: #ffffff; display: flex; align-items: center; gap: 10px; }
        .model-badge { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .layout-grid { display: grid; gap: 20px; margin-bottom: 20px; }
        .two-column { grid-template-columns: 1fr 1fr; }
        .box { border: 1px solid #333; border-radius: 8px; padding: 20px; background: #0f0f0f; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 8px; color: #b0b0b0; font-size: 14px; font-weight: 500; }
        .input-field { width: 100%; padding: 10px; border: 1px solid #333; background: #0a0a0a; color: #e0e0e0; border-radius: 6px; font-size: 14px; }
        textarea.input-field { resize: vertical; min-height: 100px; }
        .button { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .button.secondary { background: #2a2a2a; border: 1px solid #444; }
        .upload-zone { border: 2px dashed #444; border-radius: 8px; padding: 40px; text-align: center; background: #0a0a0a; cursor: pointer; }
        .multi-upload-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 15px; }
        .upload-item { position: relative; border: 1px solid #333; border-radius: 8px; padding: 20px; background: #0a0a0a; min-height: 150px; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .upload-item.filled { background: #1a1a1a; border-color: #667eea; }
        .remove-btn { position: absolute; top: 5px; right: 5px; background: #ff4444; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .slider-group { margin: 20px 0; }
        .slider-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .slider { width: 100%; height: 6px; border-radius: 3px; background: #333; outline: none; }
        .accordion { margin: 20px 0; }
        .accordion-item { border: 1px solid #333; margin-bottom: 10px; border-radius: 8px; overflow: hidden; background: #0f0f0f; }
        .accordion-header { padding: 15px; background: #1a1a1a; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .accordion-content { padding: 20px; display: none; }
        .accordion-item.active .accordion-content { display: block; }
        .capability-badge { background: #2a2a2a; padding: 4px 10px; border-radius: 4px; font-size: 12px; color: #888; }
        .model-capabilities { display: flex; gap: 10px; }
        .model-section h3 { margin-bottom: 10px; }
        .result { margin-top: 20px; }
        .result img { max-width: 100%; border-radius: 8px; }
        .model-section .note { color: #b0b0b0; font-size: 12px; margin-top: 8px; }
        .nav-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .nav-card { cursor: pointer; border: 1px solid #333; background: #0f0f0f; padding: 16px; border-radius: 8px; }
        .nav-card a { color: inherit; text-decoration: none; display: block; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® Enhanced AI Image Generation Suite</h1>

        <h2>Quick Model Selector</h2>
        <div class="model-section">
            <div class="nav-grid">
                <div class="nav-card"><a href="/models/wan25"><h4>üéØ WAN-25 Preview</h4><p class="note">Advanced image-to-image with multiple references</p></a></div>
                <div class="nav-card"><a href="/models/qwen-edit"><h4>‚úèÔ∏è Qwen Edit Plus</h4><p class="note">Smart image editing and object manipulation</p></a></div>
                <div class="nav-card"><a href="/models/product-photoshoot"><h4>üì∏ Product Photoshoot</h4><p class="note">Professional product photography generation</p></a></div>
            </div>
        </div>

        <h2>WAN-25 Preview - Advanced Image-to-Image</h2>
        <div class="model-section">
            <div class="model-header">
                <div class="model-title"><span>üéØ WAN-25 Preview</span><span class="model-badge">NEW</span></div>
                <div class="model-capabilities"><span class="capability-badge">Image-to-Image</span><span class="capability-badge">Multiple References</span><span class="capability-badge">Style Transfer</span></div>
            </div>

            <div class="layout-grid two-column">
                <div class="box">
                    <h3>Input Configuration</h3>
                    <div class="input-group">
                        <label>Prompt</label>
                        <textarea id="wan25-prompt" class="input-field" placeholder="Describe your desired transformation or style..."></textarea>
                    </div>

                    <div class="input-group">
                        <label>Primary Image</label>
                        <div id="wan25-main-upload" class="upload-zone"><div>üì∏ Drop your main image here<br><small>or click to browse</small></div></div>
                        <div id="wan25-main-preview" class="note"></div>
                    </div>

                    <div class="input-group">
                        <label>Reference Images (Optional)</label>
                        <div id="wan25-references" class="multi-upload-grid">
                            <div class="upload-item"><span>+ Add Ref 1</span></div>
                            <div class="upload-item"><span>+ Add Ref 2</span></div>
                            <div class="upload-item"><span>+ Add Ref 3</span></div>
                            <div class="upload-item"><span>+ Add Ref 4</span></div>
                        </div>
                        <div id="wan25-ref-previews" class="multi-upload-grid" style="margin-top:10px;"></div>
                    </div>

                    <div class="slider-group">
                        <div class="slider-header"><label>Image Influence</label><span id="wan25-influence-value">0.75</span></div>
                        <input id="wan25-influence" type="range" class="slider" min="0" max="1" step="0.05" value="0.75">
                    </div>

                    <div class="slider-group">
                        <div class="slider-header"><label>Style Strength</label><span id="wan25-style-value">0.5</span></div>
                        <input id="wan25-style" type="range" class="slider" min="0" max="1" step="0.05" value="0.5">
                    </div>
                </div>

                <div class="box">
                    <h3>Style & Output Settings</h3>
                    <div class="input-group">
                        <label>Aspect Ratio</label>
                        <select id="wan25-aspect" class="input-field">
                            <option value="original">Original</option>
                            <option value="1:1">1:1 Square</option>
                            <option value="16:9">16:9 Landscape</option>
                            <option value="9:16">9:16 Portrait</option>
                            <option value="4:3">4:3 Classic</option>
                            <option value="3:2">3:2 Photo</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Output Resolution</label>
                        <select id="wan25-size" class="input-field">
                            <option>512x512</option>
                            <option>768x768</option>
                            <option selected>1024x1024</option>
                            <option>1536x1536</option>
                            <option>2048x2048</option>
                        </select>
                    </div>

                    <div class="accordion">
                        <div class="accordion-item">
                            <div class="accordion-header"><span>‚öôÔ∏è Advanced Parameters</span><span>‚ñº</span></div>
                            <div class="accordion-content">
                                <div class="slider-group">
                                    <div class="slider-header"><label>Guidance Scale</label><span id="wan25-guidance-value">7.5</span></div>
                                    <input id="wan25-guidance" type="range" class="slider" min="1" max="20" step="0.5" value="7.5">
                                </div>
                                <div class="input-group">
                                    <label>Seed (Optional)</label>
                                    <input id="wan25-seed" class="input-field" type="number" placeholder="-1 for random" value="-1">
                                </div>
                                <div class="input-group">
                                    <label><input type="checkbox" id="wan25-hd"> HD Output</label>
                                </div>
                                <div class="input-group">
                                    <label><input type="checkbox" id="wan25-enhance"> Auto Enhance</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button id="generate-wan25" class="button" style="width: 100%; margin-top: 20px;">üöÄ Generate with WAN-25</button>

                    <div id="wan25-status" style="margin-top:10px;"></div>
                    <div id="wan25-result" class="result"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simple accordion
        document.querySelectorAll('.accordion-header').forEach(header => {
            header.addEventListener('click', () => header.parentElement.classList.toggle('active'));
        });

        // Slider value displays
        const bindSlider = (id, labelId) => {
            const el = document.getElementById(id);
            const label = document.getElementById(labelId);
            if (el && label) el.addEventListener('input', e => label.textContent = e.target.value);
        };
        bindSlider('wan25-influence', 'wan25-influence-value');
        bindSlider('wan25-style', 'wan25-style-value');
        bindSlider('wan25-guidance', 'wan25-guidance-value');

        // Upload helpers
        const uploaded = { main: null, references: [] };

        function setupDropZone(elementId, onFile) {
            const dz = document.getElementById(elementId);
            if (!dz) return;
            ['dragenter','dragover','dragleave','drop'].forEach(ev=>dz.addEventListener(ev,(e)=>{e.preventDefault();e.stopPropagation();}));
            dz.addEventListener('click', ()=>{
                const input=document.createElement('input'); input.type='file'; input.accept='image/*';
                input.onchange=(e)=>{ if(e.target.files?.length){ onFile(e.target.files[0]); }}; input.click();
            });
            dz.addEventListener('drop', (e)=>{ const f=e.dataTransfer.files; if(f.length) onFile(f[0]); });
        }

        function previewImage(file, targetId) {
            const target = document.getElementById(targetId);
            if (!target) return;
            const r=new FileReader(); r.onload=(e)=>{ target.innerHTML = `<img src="${e.target.result}" style="max-width:100%;max-height:200px;border-radius:6px;"> <div class=\"note\">${file.name} ‚Ä¢ ${(file.size/1024).toFixed(1)} KB</div>`; }; r.readAsDataURL(file);
        }

        function renderRefPreviews() {
            const c = document.getElementById('wan25-ref-previews'); if(!c) return; c.innerHTML='';
            uploaded.references.forEach((file, idx)=>{
                const wrap=document.createElement('div'); wrap.className='upload-item filled';
                const r=new FileReader(); r.onload=(e)=>{ wrap.innerHTML=`<img src="${e.target.result}" style=\"width:100%;height:100px;object-fit:cover;border-radius:4px;\"><button class=\"remove-btn\" data-idx=\"${idx}\">√ó</button>`; wrap.querySelector('button').onclick=()=>{ uploaded.references.splice(idx,1); renderRefPreviews();};}; r.readAsDataURL(file);
                c.appendChild(wrap);
            });
        }

        function setupMultiUpload(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.querySelectorAll('.upload-item').forEach(item=>{
                item.addEventListener('click', ()=>{
                    const input=document.createElement('input'); input.type='file'; input.accept='image/*'; input.multiple=true;
                    input.onchange=(e)=>{ const files=Array.from(e.target.files||[]); uploaded.references.push(...files.slice(0,4-uploaded.references.length)); renderRefPreviews(); };
                    input.click();
                });
            });
        }

        setupDropZone('wan25-main-upload', (file)=>{ uploaded.main=file; previewImage(file,'wan25-main-preview'); });
        setupMultiUpload('wan25-references');

        function setStatus(message, type='info') {
            const el = document.getElementById('wan25-status'); if (!el) return;
            const colors = { info: '#aaa', success: '#4CAF50', error: '#f44336' };
            const bg = type==='error' ? 'rgba(244,67,54,0.1)' : type==='success' ? 'rgba(76,175,80,0.1)' : 'transparent';
            el.innerHTML = `<div style="padding:10px;border-radius:6px;color:${colors[type]};background:${bg}">${message}</div>`;
        }

        function showLoading(containerId){ const c=document.getElementById(containerId); if(!c) return; c.innerHTML = `<div style="padding:20px;text-align:center;"><div style=\"border:3px solid #222;border-top:3px solid #667eea;border-radius:50%;width:36px;height:36px;margin:0 auto;animation:spin 1s linear infinite\"></div><p style=\"margin-top:10px;color:#aaa\">Generating...</p></div>`; }

        function showError(containerId, msg){ const c=document.getElementById(containerId); if(!c) return; c.innerHTML = `<div style="color:#f44336;background:rgba(244,67,54,0.1);padding:10px;border-radius:6px;">${msg}</div>`; }

        function showResult(containerId, result){ const c=document.getElementById(containerId); if(!c) return; const url = (result?.result?.image?.url) || (result?.image?.url) || result?.image_url; c.innerHTML = url ? `<img src="${url}" alt="Result"><div class=\"note\">Done</div>` : `<div class=\"note\">No image URL in response</div>`; }

        document.getElementById('generate-wan25').addEventListener('click', async (e)=>{
            const btn = e.currentTarget; btn.disabled = true; btn.textContent = '‚è≥ Generating...'; setStatus('Submitting job...', 'info');
            if(!uploaded.main){ alert('Please upload a main image'); return; }
            const settings = {
                prompt: document.getElementById('wan25-prompt').value || '',
                image_influence: parseFloat(document.getElementById('wan25-influence').value),
                style_strength: parseFloat(document.getElementById('wan25-style').value),
                aspect_ratio: document.getElementById('wan25-aspect').value,
                output_size: document.getElementById('wan25-size').value,
                guidance_scale: parseFloat(document.getElementById('wan25-guidance').value),
                seed: parseInt(document.getElementById('wan25-seed').value)||-1,
                hd_output: document.getElementById('wan25-hd').checked,
                auto_enhance: document.getElementById('wan25-enhance').checked
            };
            // persist settings
            try { localStorage.setItem('wan25_settings', JSON.stringify(settings)); } catch {}
            const fd = new FormData();
            fd.append('main_image', uploaded.main);
            uploaded.references.forEach(f=> fd.append('reference_images', f));
            fd.append('settings', JSON.stringify(settings));
            showLoading('wan25-result');
            try{
                const resp = await fetch('/api/generate/wan25-preview', { method: 'POST', body: fd });
                const data = await resp.json();
                if(!resp.ok){ throw new Error(data?.detail||data?.error||'Request failed'); }
                showResult('wan25-result', data);
                setStatus('‚úÖ Generation completed', 'success');
            }catch(e){ showError('wan25-result', e.message||String(e)); }
            finally { btn.disabled = false; btn.textContent = 'üöÄ Generate with WAN-25'; }
        });

        // Restore settings on load
        (function restoreSettings(){
            try {
                const saved = JSON.parse(localStorage.getItem('wan25_settings')||'null');
                if(!saved) return;
                const set = (id, v)=>{ const el=document.getElementById(id); if(el!=null){ if(el.type==='checkbox') el.checked=!!v; else el.value=v; } };
                set('wan25-prompt', saved.prompt||'');
                set('wan25-influence', saved.image_influence); document.getElementById('wan25-influence-value').textContent = saved.image_influence;
                set('wan25-style', saved.style_strength); document.getElementById('wan25-style-value').textContent = saved.style_strength;
                set('wan25-aspect', saved.aspect_ratio);
                set('wan25-size', saved.output_size);
                set('wan25-guidance', saved.guidance_scale); document.getElementById('wan25-guidance-value').textContent = saved.guidance_scale;
                set('wan25-seed', saved.seed);
                set('wan25-hd', saved.hd_output);
                set('wan25-enhance', saved.auto_enhance);
            } catch {}
        })();
    </script>
</body>
</html>


